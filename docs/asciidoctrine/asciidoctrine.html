<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Benjamin Kober">
<title>ASCIIdoctrine</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>ASCIIdoctrine</h1>
<div class="details">
<span id="author" class="author">Benjamin Kober</span><br>
<span id="email" class="email"><a href="mailto:benko@kober-systems.com">benko@kober-systems.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_einstieg">Einstieg</a></li>
<li><a href="#_übersicht">Übersicht</a>
<ul class="sectlevel2">
<li><a href="#_motivation_und_hintergrund">Motivation und Hintergrund</a></li>
<li><a href="#_programmarchitektur">Programmarchitektur</a></li>
</ul>
</li>
<li><a href="#_implementierung">Implementierung</a>
<ul class="sectlevel2">
<li><a href="#input-format">Eingabeformate</a>
<ul class="sectlevel3">
<li><a href="#_asciidoc">Asciidoc</a>
<ul class="sectlevel4">
<li><a href="#_grundlegender_aufbau_eines_asciidoc_dokuments">Grundlegender Aufbau eines Asciidoc Dokuments</a></li>
<li><a href="#_document_header">Document Header</a></li>
<li><a href="#_attribute_2">Attribute</a></li>
<li><a href="#_überschriften">Überschriften</a></li>
<li><a href="#_absätze">Absätze</a></li>
<li><a href="#_textformattierung">Textformattierung</a></li>
<li><a href="#_listen">Listen</a></li>
<li><a href="#_links">Links</a></li>
<li><a href="#_querverweise">Querverweise</a></li>
<li><a href="#_fußnoten">Fußnoten</a></li>
<li><a href="#_bilder">Bilder</a></li>
<li><a href="#_tabellen">Tabellen</a></li>
<li><a href="#_kommentare">Kommentare</a></li>
<li><a href="#_quellcode_blöcke">Quellcode Blöcke</a></li>
<li><a href="#_beispiel_blöcke">Beispiel Blöcke</a></li>
<li><a href="#_andere_dokumente_einbinden">Andere Dokumente einbinden</a></li>
</ul>
</li>
<li><a href="#_json">Json</a></li>
</ul>
</li>
<li><a href="#output-format">Ausgabeformate</a>
<ul class="sectlevel3">
<li><a href="#html5">Html5</a></li>
<li><a href="#_json_2">Json</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_asciidoctrine_in_andere_programme_einbinden">asciidoctrine in andere Programme einbinden</a>
<ul class="sectlevel2">
<li><a href="#cmd-api">Aufruf auf der Kommandozeile</a></li>
</ul>
</li>
<li><a href="#extensions">asciidoctrine erweitern</a>
<ul class="sectlevel2">
<li><a href="#reader">Neue Datenformate einlesen</a></li>
<li><a href="#extension">Den AST verarbeiten/modifizieren</a></li>
<li><a href="#writer">Neue Ausgabeformate unterstützen</a></li>
<li><a href="#ast">Der Abstract Syntax Tree</a></li>
</ul>
</li>
<li><a href="#_tmp_implementierung">tmp Implementierung</a></li>
<li><a href="#install">Installation</a></li>
<li><a href="#_build">Build</a></li>
<li><a href="#_tests">Tests</a>
<ul class="sectlevel2">
<li><a href="#_testumgebung">Testumgebung</a></li>
</ul>
</li>
<li><a href="#_verwandte_projekte">Verwandte Projekte</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Eine asciidoc Implementierung in rust.</p>
</div>
<div class="paragraph">
<p>ASCIIdoctrine will möglichst kompatibel zur asciidoc Interpretation von <a href="http://asciidoctor.org">asciidoctor</a> sein, so dass es als Drop-in Ersatz genutzt werden kann. Allerdings ist es in <a href="https://www.rust-lang.org/">rust</a> geschrieben und hat das Ziel flexibeler und leichter zu portieren zu sein.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_einstieg">Einstieg</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je nach Interessenlage und Beweggrund zum lesen dieses Artikels wird man
unterschiedlich an ihn herangehen.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect2">
<h3 id="_einstieg_tutorials">Einstieg &amp; Tutorials</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#install">Installation</a></p>
</li>
<li>
<p>Will man einfach Texte mit <code>asciidoc</code> Markup verfassen sollte man zum
<a href="#asciidoc-syntax">ASCIIdoc Syntax</a> Abschnitt gehen oder zur Beschreibung
der <a href="#cmd-api">Kommandozeilenparameter</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Alternativ findet man auch in der
<a href="https://docs.asciidoctor.org/asciidoc/latest/">Aciidoc Language
Documentation</a> vom asciidoctor Projekt eine hervorragende Übersicht.</p>
</li>
<li>
<p>Dort gibt es auch eine
<a href="https://docs.asciidoctor.org/asciidoc/latest/syntax-quick-reference/">Quick
Syntax Reference</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect2">
<h3 id="_how_to_guides">How-To Guides</h3>

</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect2">
<h3 id="_hintergrund_informationen">Hintergrund Informationen</h3>
<div class="ulist">
<ul>
<li>
<p>Will man wissen wie das Programm funktioniert oder es anpassen kann man
einfach weiterlesen.</p>
</li>
</ul>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect2">
<h3 id="_referenz">Referenz</h3>
<div class="ulist">
<ul>
<li>
<p>API <a href="https://docs.rs/asciidoctrine/latest/asciidoctrine/">documentation</a></p>
</li>
</ul>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_übersicht">Übersicht</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dieses Programm ist im <a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a> Stil geschrieben. Gie Grundidee ist eine ASCIIdoc Benutzeranleitung so umzuarbeiten, dass sie sich automatisch zu einem ausführbaren Programm mit Tests kompilieren lässt.</p>
</div>
<div class="paragraph">
<p>Dazu verwenden wir <a href="https://kober-systems.github.io/literate_programming_toolsuite/lisi/lisi.html">lisi</a> (welches im gleichen Repo verwaltet wird) als Werkzeug.</p>
</div>
<div class="sect2">
<h3 id="_motivation_und_hintergrund">Motivation und Hintergrund</h3>
<div class="paragraph">
<p>Das Programm <a href="http://jgm.github.io/lunamark/doc/lunamark.html">lunamark</a> hat
ursprünglich mein Interesse für <a href="http://www.lua.org">lua</a>,
<a href="http://www.inf.puc-rio.br/~roberto/lpeg/">lpeg</a> und die Implementierung von
Parsern im Allgemeinen geweckt. Ich war begeistert wie der Eingabetext mit
Mustern abgesucht und umgewandelt wurde (vorher kannte ich nur
<a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a> und wäre
bei solch komplexen Aufgaben sofort an Grenzen gestoßen).</p>
</div>
<div class="paragraph">
<p>Ich fing an einen asciidoc parser für lunamark zu schreiben. Nach einiger Zeit
stellten sich ein paar Probleme heraus:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lunamark ist für <a href="https://daringfireball.net/projects/markdown/">markdown</a>
geschrieben und das ist nicht für beliebig komplexe Dokumente geeignet.</p>
</li>
<li>
<p>Der Eingabetext wird sofort in das Ausgabeformat umgewandelt und nicht in
einen <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Das zweite Problem ist in meinem Fall problematischer als das erste, da ich das Werkzeug nicht nur benutzen will um Dokumente zu erstellen. Hat man einen AST kann man nach belieben filtern, umsortieren, bearbeiten und in völlig andere Formate einbauen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_programmarchitektur">Programmarchitektur</h3>
<div class="paragraph">
<p>Aus diesem Grund soll dieses Programm mehrschrittig vorgehen und alle Dateien
zunächst in einen AST umwandeln:</p>
</div>
<div id="dataflow-outline" class="imageblock">
<div class="content">
<img src="data:image/png;base64,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KCAG/SAGEdOIbkRBROZJfTS3pF65ublz587VJ4PQ5OfnX3nllTIHVVRUyPhoaGhw9DfvvkyYMOHdd981Ty5RXX755Q899ND69es/+eQTdV+OHz9uXrIIibk4YsQiCohBP4hBxDSiG1EQkXlSH80tqVd2dvaOHTv0ySA0Miz69u1bXFwshb179x49ejS01DxMmZmZlZWV5sklJLka6enpL7zwwrJly0pKSsrKyg4ePHjs2DHzkkVIzMURIxZOO0UM+kUMInadIroRFRGZJ/XR3JJ6paWl1dXV6ZNBaGpqalJSUt57770PP/zw888/P3z4sHP//eOLvKhMheaZJSq5C6mpqfn5+QsXLiwqKtq6dev+/fude2OIuThixMJpxKB/xCBiF9GN6IjIPKmP5pbUKykp6ZTttBAauYZdunSxz0ENDQ3mtXbY8uXLx4wZY55ZopozZ86gQYNeeumld999d+3atdu3bz948GBTU5N51SIk5uLoFCMWDiMG/TtFDCJmEd2IjlORmCf10dySelmW50wQDrmSBQUF8k5WWlpaUVFRW1trXmuHPfXUU3fccYd5Wonqd7/73bhx41555ZXFixevX79+x44dVVVVLS0t5lWLkFiMI0YsHEUMdogYRIwiuhE14c+TnkPpktkluhjQkSJXct68eUuXLt24cWN5efmRI0fMa+2wqVOnvvDCC+ZpJarvf//7N95449y5c99///2SkpJdu3ZVV1eH9ljSQMRiHDFi4ShisEPEIGIU0Y2oCX+e9BxKl8wu0cWAjhS5kjINLVmyRKahnTt3yjRkXmuHjRw5sri42DytRJWdnT19+vT58+cvX778448/rqioqKmpMS9Z5MRiHDFi4ShisEPEIGIU0Y2oCX+e9BxKl8wu0cWAjhS5kq+99poMjg8//FAGx1dffWVeayedOHGie/fufA9VOX78eLdu3Z599tkFCxasWrVqy5Yte/fuDeHzwYGLxThixMI5xGAgiEHEIqIb0RT+POk5lC6ZXaKLAR0p4Q+OcHz22WcDBw40zylRrVmzpk+fPrNmzXr77bdXr169bdu2AwcOhPBUnMDFYhwxYuEcYjAQxCBiEdGNaAp/nvQcSpfMLtHFgI4UNTj0EzBDGBzheP311ydNmmSeU6L6y1/+MnTo0Dlz5hQWFq5bt05WGIcOHQrhb0EELhbjiBEL5xCD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" alt="Diagram" width="1150" height="308">
</div>
<div class="title">Figure 1. Module und Datenstrom in asciidoctrine</div>
</div>
<div class="paragraph">
<p>So kann man einerseits leicht unterschiedliche <a href="#generate-output">Ausgabeformate</a> unterstützen und andererseits eine <a href="#api">[api]</a> zur Verfügung stellen, die Zugriff auf die gesamte Dokumentstruktur gibt.</p>
</div>
<div class="paragraph">
<p>Der generelle Ablauf ist folgendermaßen:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Die Eingabedatei(en) wird(werden) eingelesen</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Diese wird von einem <a href="#reader">Neue Datenformate einlesen</a> eingelesen und in einen AST umgewandelt.</p>
</li>
<li>
<p>Der <a href="#reader">Neue Datenformate einlesen</a> wird nur einmal ausgewählt und ist (im Fall von mehreren
Eingabedateien) für alle Eingabedateien gleich.</p>
</li>
<li>
<p>Das standardmäßige Eingabeformat ist <a href="#asciidoc-syntax">[asciidoc-syntax]</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Der AST wird von einer oder mehreren Erweiterungen modifiziert</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Jede <a href="#extensions">Erweiterung</a> bekommt einen AST als Parameter übergeben
und gibt einen AST zurück.</p>
</li>
<li>
<p>Erweiterungen können über die <a href="#cmd-api">Kommandozeile</a> oder die <a href="#api">[api]</a>
weitere Parameter und Steuerungsdateien (von beliebigem Format) übergeben
werden.</p>
</li>
<li>
<p>Es können beliebig viele Erweiterungen in beliebiger Reihenfolge
hintereinander geschaltet werden.</p>
</li>
<li>
<p>Ob eine Erweiterung eigene Ausgabedateien erzeugt, bleibt ihr selbst
überlassen.</p>
</li>
<li>
<p>Standardmäßig sind keine Erweiterungen aktiviert.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Ein Output Prozessor (Writer) wandelt den AST in eine Ausgabedatei um</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Der Writer kann über die <a href="#cmd-api">Kommandozeile</a> oder die <a href="#api">[api]</a> Parameter
oder Styledateien (wie css-Stylesheets etc) übergeben bekommen.</p>
</li>
<li>
<p>Das standardmäßige Ausgabeformat ist <a href="#html5">Html5</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementierung">Implementierung</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>asciidoctrine</code> ist ein rust Programm. Der Hauptteil des Programms ist in einer
Bibliothek implementiert. Ein kleiner Teil ist ein Kommandozeilenprogramm
welches diese Bibliothek benutzt und die Parameter übergibt.</p>
</div>
<div class="listingblock">
<div class="title">src/lib.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-o">&lt;&lt;</span><span class="tok-n">crate_usages</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">internal_modules</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">public_structs</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">interfaces</span><span class="tok-o">|</span><span class="tok-n">join</span><span class="tok-o">=</span><span class="tok-s">&quot;</span><span class="tok-se">\n\n</span><span class="tok-s">&quot;</span><span class="tok-o">&gt;&gt;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Bibliothek wiederum teilt den Großteil ihrer Aufgaben einigen abgetrennten
Modulen zu:</p>
</div>
<div id="internal_modules" class="listingblock">
<div class="title">Module innerhalb des crates</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">ast</span><span class="tok-p">;</span><span class="tok-w">         </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-p">::</span><span class="tok-o">*</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">cli_template</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">options</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">util</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">extract_toc</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">reader</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-p">::</span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">AsciidocReader</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-p">::</span><span class="tok-n">json</span><span class="tok-p">::</span><span class="tok-n">JsonReader</span><span class="tok-p">;</span>
<span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">writer</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-p">::</span><span class="tok-n">html</span><span class="tok-p">::</span><span class="tok-n">HtmlWriter</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-p">::</span><span class="tok-n">docx</span><span class="tok-p">::</span><span class="tok-n">DocxWriter</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-p">::</span><span class="tok-n">json</span><span class="tok-p">::</span><span class="tok-n">JsonWriter</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ast</code> definiert das allgemeine Zwischenformat für alle Dokumente.</td>
</tr>
</table>
</div>
<div id="public_structs" class="listingblock">
<div class="title">Fehlerbehandlung</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#[derive(Error, Debug)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">AsciidoctrineError</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(</span><span class="tok-s">&quot;could not parse input&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-n">Parse</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">pest</span><span class="tok-p">::</span><span class="tok-n">error</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-o">&lt;</span><span class="tok-n">reader</span><span class="tok-p">::</span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">Json</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">serde_json</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">io</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">BufWriter</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">io</span><span class="tok-p">::</span><span class="tok-n">IntoInnerError</span><span class="tok-o">&lt;</span><span class="tok-n">io</span><span class="tok-p">::</span><span class="tok-n">BufWriter</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-kt">u8</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">Template</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">tera</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">Utf8</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-kt">str</span><span class="tok-p">::</span><span class="tok-n">Utf8Error</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(transparent)]</span>
<span class="tok-w">  </span><span class="tok-n">Docx</span><span class="tok-p">(</span><span class="tok-cp">#[from]</span><span class="tok-w"> </span><span class="tok-n">docx_rs</span><span class="tok-p">::</span><span class="tok-n">DocxError</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(</span><span class="tok-s">&quot;Child process stdin has not been captured!&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-n">Childprocess</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[error(</span><span class="tok-s">&quot;malformed ast structure&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-n">MalformedAst</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">type</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">result</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">AsciidoctrineError</span><span class="tok-o">&gt;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div id="crate_usages" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">extern</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-w"> </span><span class="tok-n">pest</span><span class="tok-p">;</span>
<span class="tok-cp">#[macro_use]</span>
<span class="tok-k">extern</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-w"> </span><span class="tok-n">pest_derive</span><span class="tok-p">;</span>

<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">io</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">thiserror</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="input-format">Eingabeformate</h3>
<div class="listingblock">
<div class="title">src/reader/mod.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">asciidoc</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">json</span><span class="tok-p">;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div id="asciidoc-syntax" class="paragraph">
<p>Unresolved directive in asciidoctrine.adoc - include::asciidoc-syntax.adoc[]</p>
</div>
<div class="sect3">
<h4 id="_asciidoc">Asciidoc</h4>
<div class="paragraph">
<p>Asciidoc ist ein einfaches Text Markup Format.</p>
</div>
<div class="paragraph">
<p>Wir verwenden <a href="https://pest.rs/">pest</a> um die Syntax zu parsen. Es verwendet <a href="https://pest.rs/book/grammars/peg.html">Parsing Expression Grammars</a> um Daten zu parsen.</p>
</div>
<div class="paragraph">
<p>TODO TOML Eintrag</p>
</div>
<div class="paragraph">
<p>Die grundlegende Syntax definieren wir in einer eigenen Datei welche wir in unserer PEG DSL schreiben.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock">
<div class="title">src/reader/asciidoc.pest</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-o">&lt;&lt;</span><span class="tok-n">basic_document_structure</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">blocks</span><span class="tok-o">|</span><span class="tok-n">join</span><span class="tok-o">=</span><span class="tok-s">&quot;</span><span class="tok-se">\n\n</span><span class="tok-s">&quot;</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-c1">////////////////////////////////////////////////////////////////////////////////</span>
<span class="tok-c1">// often resused elements</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">peg_building_blocks</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-c1">////////////////////////////////////////////////////////////////////////////////</span>
<span class="tok-c1">// inline elements</span>

<span class="tok-n">inline</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">comment</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">link</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">strong</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">emphasized</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">monospaced</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">quoted</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">footnote</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">footnoteref</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">xref</span>
<span class="tok-p">}</span>
<span class="tok-n">other_inline</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">@</span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">inline</span><span class="tok-w"> </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">ANY</span><span class="tok-p">)</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-p">}</span>
<span class="tok-n">inline_parser</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-cp">$</span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">inline</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">other_inline</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-p">}</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">inline_elements</span><span class="tok-o">|</span><span class="tok-n">join</span><span class="tok-o">=</span><span class="tok-s">&quot;</span><span class="tok-se">\n\n</span><span class="tok-s">&quot;</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-c1">////////////////////////////////////////////////////////////////////////////////</span>
<span class="tok-c1">// generics</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">generic_pegs</span><span class="tok-o">|</span><span class="tok-n">join</span><span class="tok-o">=</span><span class="tok-s">&quot;</span><span class="tok-se">\n\n</span><span class="tok-s">&quot;</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-c1">////////////////////////////////////////////////////////////////////////////////</span>

<span class="tok-c1">// Implicit whitespace rule</span>
<span class="tok-n">WHITESPACE</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-s">&quot; &quot;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&quot;</span><span class="tok-se">\t</span><span class="tok-s">&quot;</span><span class="tok-w"> </span><span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="paragraph">
<p>Damit können wir die Syntax in einer relativ formalen Sprache definieren welche das parsen erleichtert. Diesem, noch eher groben AST, weisen wir dann eine semantische Bedeutung zu. Den Code dazu definieren wir in einem eigenen Rust Modul mit dem Namen <code>asciidoc.rs</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/reader/asciidoc.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">ast</span><span class="tok-p">::</span><span class="tok-o">*</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">util</span><span class="tok-p">::{</span><span class="tok-n">Env</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">reader</span><span class="tok-p">::</span><span class="tok-o">*</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">pest</span><span class="tok-p">::</span><span class="tok-n">iterators</span><span class="tok-p">::</span><span class="tok-n">Pair</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">pest</span><span class="tok-p">::</span><span class="tok-n">Parser</span><span class="tok-p">;</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">AsciidocReader</span><span class="tok-w"> </span><span class="tok-p">{}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">AsciidocReader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">AsciidocReader</span><span class="tok-w"> </span><span class="tok-p">{}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">Reader</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">AsciidocReader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">Opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">AsciidocParser</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">asciidoc</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">attributes</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">args</span><span class="tok-p">.</span><span class="tok-n">input</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">to_str</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">attributes</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;source&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">()),</span>
<span class="tok-w">        </span><span class="tok-p">});</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">elements</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">process_element</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">elements</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">);</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">AST</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">input</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">elements</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">attributes</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Parser, Debug, Copy, Clone)]</span>
<span class="tok-cp">#[grammar = </span><span class="tok-s">&quot;reader/asciidoc.pest&quot;</span><span class="tok-cp">]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">AsciidocParser</span><span class="tok-p">;</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-o">&lt;&lt;</span><span class="tok-n">asciidoc_element_rules</span><span class="tok-o">&gt;&gt;</span>
<span class="tok-w">    </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">block</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">extract_inner_rule</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_inline</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">)),</span>
<span class="tok-w">    </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-p">};</span>

<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-p">}</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">asciidoc_parser_functions</span><span class="tok-o">|</span><span class="tok-n">join</span><span class="tok-o">=</span><span class="tok-s">&quot;</span><span class="tok-se">\n\n</span><span class="tok-s">&quot;</span><span class="tok-o">&gt;&gt;</span>

<span class="tok-c1">// Helper functions</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">concat_elements</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">filter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">join</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">elements</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">filter</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">e</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">filter</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">e</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">())</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">elements</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">elements</span><span class="tok-p">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">join</span><span class="tok-p">))</span>
<span class="tok-w">  </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">None</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_children</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">;</span>

<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">process_element</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">))</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-n">base</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">extract_inner_rule</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">);</span>
<span class="tok-w">  </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_element</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;must have a subfield in the parser but nothing is found&quot;</span><span class="tok-p">)),</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">set_span</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">from_element</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">element</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">(</span><span class="tok-fm">format!</span><span class="tok-p">(</span><span class="tok-s">&quot;Not implemented:{:?}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">)),</span>
<span class="tok-w">  </span><span class="tok-p">)</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">from_element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">rule</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">start_line</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">start_col</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">rule</span><span class="tok-p">.</span><span class="tok-n">as_span</span><span class="tok-p">().</span><span class="tok-n">start_pos</span><span class="tok-p">().</span><span class="tok-n">line_col</span><span class="tok-p">();</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">end_line</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">end_col</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">rule</span><span class="tok-p">.</span><span class="tok-n">as_span</span><span class="tok-p">().</span><span class="tok-n">end_pos</span><span class="tok-p">().</span><span class="tok-n">line_col</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-n">ElementSpan</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">element</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">source</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-c1">// TODO</span>
<span class="tok-w">    </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">rule</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">children</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">positional_attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">start</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">rule</span><span class="tok-p">.</span><span class="tok-n">as_span</span><span class="tok-p">().</span><span class="tok-n">start</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">end</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">rule</span><span class="tok-p">.</span><span class="tok-n">as_span</span><span class="tok-p">().</span><span class="tok-n">end</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">start_line</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">start_col</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">end_line</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">end_col</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</details>
<div class="sect4">
<h5 id="_grundlegender_aufbau_eines_asciidoc_dokuments">Grundlegender Aufbau eines Asciidoc Dokuments</h5>
<div class="paragraph">
<p>Asciidoc interpretiert einen Text als eine Sammlung von Blöcken,
welche durch Leerzeilen getrennt sind. Wenn irgendein Text nicht als
ein anderer Block interpretiert werden kann, so wird er als Paragraph
interpretiert. Dadurch ist jedes Text-Dokument eine valide Asciidoc
Datei.</p>
</div>
<div id="basic_document_structure" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">asciidoc</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">NEWLINE</span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">block</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-w">  </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">NEWLINE</span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-p">}</span>

<span class="tok-n">block</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-o">&lt;&lt;</span><span class="tok-n">block_entries</span><span class="tok-o">&gt;&gt;</span>
<span class="tok-w">  </span><span class="tok-c1">// admonition |</span>
<span class="tok-w">  </span><span class="tok-c1">// example |</span>
<span class="tok-w">  </span><span class="tok-c1">// fenced |</span>
<span class="tok-w">  </span><span class="tok-c1">// listing |</span>
<span class="tok-w">  </span><span class="tok-c1">// literal |</span>
<span class="tok-w">  </span><span class="tok-c1">// open |</span>
<span class="tok-w">  </span><span class="tok-c1">// passthrough |</span>
<span class="tok-w">  </span><span class="tok-c1">// quote |</span>
<span class="tok-w">  </span><span class="tok-c1">// sidebar |</span>
<span class="tok-w">  </span><span class="tok-c1">// source |</span>
<span class="tok-w">  </span><span class="tok-c1">// stem |</span>
<span class="tok-w">  </span><span class="tok-c1">// table |</span>
<span class="tok-w">  </span><span class="tok-c1">// verse |</span>
<span class="tok-w">  </span><span class="tok-n">image_block</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">include_macro</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">list</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-n">attribute_entry_block</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-c1">// Title is nearly the last because it could prevent correct match of others</span>
<span class="tok-w">  </span><span class="tok-n">title_block</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-c1">// paragraph is the last because all others should be checked first</span>
<span class="tok-w">  </span><span class="tok-n">paragraph</span><span class="tok-w"> </span><span class="tok-o">|</span>
<span class="tok-w">  </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-o">~</span><span class="tok-w"> </span><span class="tok-n">ANY</span><span class="tok-p">)</span><span class="tok-o">+</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_wichtige_konzepte">Wichtige Konzepte</h6>
<div class="paragraph">
<p>Einige Elemente sind in ASCIIdoc wiederkehrend und können in
verschiedenen Kontexten verwendet werden. Die wichtigsten von ihnen
gehen wir jetzt durch.</p>
</div>
<div class="paragraph">
<p>TODO Attribut Listen etc</p>
</div>
<div class="sect6">
<h7 id="_elemente">Elemente</h7>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect6">
<h7 id="_anker">Anker</h7>
<div class="paragraph">
<p>Oft möchte man Blöcke, Absätze etc referenzieren um sich später darauf
zu beziehen. Asciidoc stellt dafür Anker zur Verfügung. Grundlegend sind
es einfach Identifier (also Namen), welche man in <code>[[</code> und <code>]]</code> einrahmt
und vor das entsprechende Element bzw vor den Block stellt.</p>
</div>
<div id="peg_building_blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>anchor = { inline_anchor ~ NEWLINE }
inline_anchor = { &quot;[[&quot; ~ (identifier | path) ~ &quot;]]&quot; }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_anchor</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_anchor</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline_anchor</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_inline_anchor</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">identifier</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;anchor&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">        </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-p">}),</span>
<span class="tok-w">      </span><span class="tok-c1">// TODO Fehler abfangen und anzeigen</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect6">
<h7 id="_attribute">Attribute</h7>
<div class="paragraph">
<p>Man kann jedem Element Eigenschaften (Attribute) zuordnen. Diese können
beispielsweise später verwendet werden um beim rendern bestimmte Styles
anzuwenden.</p>
</div>
<div class="paragraph">
<p>Um einem Element Attribute zuzuordnen rahmt man die Liste der Attribute
in <code>[</code> und <code>]</code> und stellt sie dem Element bzw Block vorran.</p>
</div>
<div id="peg_building_blocks" class="listingblock">
<div class="title">Element Attribute</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>attribute_list = { inline_attribute_list ~ NEWLINE }

inline_attribute_list = {
  &quot;[&quot; ~ (attribute ~ (&quot;,&quot; ~ attribute)* )? ~ &quot;]&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grundsätzlich gibt es zwei Arten von Attributen: Benannte und
Unbenannte.</p>
</div>
<div class="paragraph">
<p>Unbenannte Attribute werden einfach ein oder abgeschaltet. Deshalb
ist es nicht nötig, ihnen einen Wert zuzuweisen. Wenn sie in der
Attributliste auftauchen, sind sie automatisch eingeschaltet.</p>
</div>
<div class="paragraph">
<p>Benannte Attribute können unterschiedliche Werte annehmen. Deshalb
bekommen sie einen Namen, an den ein Wert übergeben wird, namch dem
Schema <code>name=wert</code>.</p>
</div>
<div id="peg_building_blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>attribute = { named_attribute | attribute_value }
named_attribute = { identifier ~ &quot;=&quot; ~ attribute_value }
attribute_value = {
  (&quot;\&quot;&quot; ~ inner_attribute_value ~ &quot;\&quot;&quot;) |
  ( (!&quot;,&quot; ~ !&quot;]&quot; ~ ANY)+ )
}
inner_attribute_value = { ( &quot;\\\&quot;&quot; | (!&quot;\&quot;&quot; ~ ANY))* }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_inline_attribute_list</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">attribute</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">sub</span>
<span class="tok-w">        </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">        </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">attribute_value</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_positional_attribute</span><span class="tok-p">(</span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">())),</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">named_attribute</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">rules</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">rules</span>
<span class="tok-w">              </span><span class="tok-p">.</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">identifier</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">                </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-p">})</span>
<span class="tok-w">              </span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">()</span>
<span class="tok-w">              </span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">rules</span>
<span class="tok-w">              </span><span class="tok-p">.</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">attribute_value</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">concat</span><span class="tok-p">()),</span>
<span class="tok-w">                </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-p">})</span>
<span class="tok-w">              </span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span>

<span class="tok-w">            </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">              </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">key</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span>
<span class="tok-w">            </span><span class="tok-p">})</span>
<span class="tok-w">          </span><span class="tok-p">}</span>
<span class="tok-w">          </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">)),</span>
<span class="tok-w">        </span><span class="tok-p">}),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">)),</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_attribute_list</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_attribute_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline_attribute_list</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">)),</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect6">
<h7 id="_blocktitel_elementtitel">Blocktitel (Elementtitel)</h7>
<div class="paragraph">
<p>Blöcke haben oft ihre eigenen Titel. In Asciidoc werden sie durch eine
Zeile vor dem Block gekennzeichnet, welche mit einem <code>.</code> beginnt.</p>
</div>
<div id="peg_building_blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>blocktitle = { &quot;.&quot; ~ !&quot;.&quot; ~ line ~ NEWLINE }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_blocktitle</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;title&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">        </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-p">}),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">)),</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect6">
<h7 id="_abgetrennte_blöcke">Abgetrennte Blöcke</h7>
<div class="paragraph">
<p>Ein sehr häufig genutztes Element sind abgetrennte Blöcke. Sie erlauben
einen Text in einem speziellen Style hervorzuheben.</p>
</div>
<div class="paragraph">
<p>Der generelle Aufbau ist folgender:</p>
</div>
<div id="delimited_block_template" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>delimited_&lt;&lt;blocktype&gt;&gt; = {
  PUSH(&quot;&lt;&lt;delimiter&gt;&gt;&quot;{4,}) ~ NEWLINE ~
  delimited_inner ~
  NEWLINE ~ POP ~ &amp;(NEWLINE | EOI)
}</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="block_entries" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>delimited_block |</code></pre>
</div>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>delimited_block = {
  (anchor | attribute_list | blocktitle)* ~
  (
    //delimited_admonition |
    delimited_comment |
    delimited_example |
    //delimited_fenced |
    //delimited_listing |
    delimited_literal |
    //delimited_open |
    //delimited_passthrough |
    //delimited_quote |
    //delimited_sidebar |
    delimited_source |
    //delimited_stem |
    delimited_table |
    delimited_verse
  )
}

delimited_inner = @{ (!(NEWLINE ~ PEEK) ~ ANY)* }</code></pre>
</div>
</div>
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_block</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_delimited_block</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)),</span></code></pre>
</div>
</div>
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_delimited_block</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">anchor</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_anchor</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">attribute_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_attribute_list</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">blocktitle</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_blocktitle</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_table</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inner_table</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Table</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_comment</span>
<span class="tok-w">      </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_source</span>
<span class="tok-w">      </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_literal</span>
<span class="tok-w">      </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_example</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_delimited_inner</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">(),</span>
<span class="tok-w">        </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">TypedBlock</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_comment</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Comment</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_source</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_literal</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Listing</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_example</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Example</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-fm">unreachable!</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-p">},</span>
<span class="tok-w">        </span><span class="tok-p">}),</span>
<span class="tok-w">        </span><span class="tok-n">env</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">)),</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_delimited_inner</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_inner</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">TypedBlock</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">BlockType</span><span class="tok-p">::</span><span class="tok-n">Example</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span>
<span class="tok-w">        </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">AsciidocParser</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">asciidoc</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span>

<span class="tok-w">          </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">process_element</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">              </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">          </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">        </span><span class="tok-p">})</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_document_header">Document Header</h5>
<div class="paragraph">
<p>Viele Dokumente beginnen mit einem Header. Es ist die Hauptüberschrift
und kann optional noch einige Metadaten enthalten welche sich auf das
ganze Doument beziehen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>asciidoc = _{ header? ~ (NEWLINE* ~ block)*  ~ NEWLINE* ~ EOI }</pre>
</div>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>header = {
  title ~
  (NEWLINE ~ author_info)? ~
  (NEWLINE ~ revision_info)? ~
  ( (NEWLINE ~ attribute_entry) |
    (NEWLINE ~ &quot;//&quot; ~ (!EOI ~ !NEWLINE ~ ANY)* ~ &amp;NEWLINE ) // TODO Comment entfernen
  )*
  ~ &amp;NEWLINE{2,}
}</code></pre>
</div>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>revision_info = { identifier } // TODO

author_info = { word+ ~ email? ~ &amp;NEWLINE }

email = { &quot;&lt;&quot; ~ (LETTER | &quot;.&quot; )+ ~ &quot;@&quot; ~ (LETTER | &quot;.&quot; )+ ~ &quot;&gt;&quot; }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_attribute_2">Attribute</h5>
<div class="paragraph">
<p>Manchmal will man eine Eigenschaft des Dokument verändern. Dazu
verwendet man Attributblöcke.</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>attribute_entry = { &quot;:&quot; ~ identifier ~ &quot;:&quot; ~ identifier? ~ &amp;NEWLINE }
attribute_entry_block = { attribute_entry ~ NEWLINE }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_überschriften">Überschriften</h5>
<div class="paragraph">
<p>Überschriften werden verwendet um das Dokument in Unterthemen zu gruppieren.</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>title_block = { anchor* ~ title }
title = {
  (line ~ NEWLINE ~ setext_title_style ) |
  (atx_title_style ~ line)
}
setext_title_style = { (&quot;=&quot;{4,} | &quot;-&quot;{4,} | &quot;~&quot;{4,} | &quot;^&quot;{4,} ) ~ &amp;NEWLINE }
atx_title_style = { &quot;=&quot;+ }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">title</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_title</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">)),</span>
<span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">header</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">title_block</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">title</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_title</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">anchor</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_anchor</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-c1">// We just take the attributes at the beginning</span>
<span class="tok-w">      </span><span class="tok-c1">// of the element.</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}))</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_title</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">title</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">atx_title_style</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Title</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">level</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">subelement</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">,</span>
<span class="tok-w">          </span><span class="tok-p">}),</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">setext_title_style</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">().</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Title</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">level</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">match</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">chars</span><span class="tok-p">().</span><span class="tok-n">next</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">              </span><span class="tok-sc">&#39;=&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-sc">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-sc">&#39;~&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-sc">&#39;^&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-p">,</span>
<span class="tok-w">              </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Unsupported title formatting&quot;</span><span class="tok-p">);</span>
<span class="tok-w">              </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">},</span>
<span class="tok-w">          </span><span class="tok-p">}),</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">          </span><span class="tok-p">}),</span>
<span class="tok-w">          </span><span class="tok-c1">// We just take the attributes at the beginning</span>
<span class="tok-w">          </span><span class="tok-c1">// of the element.</span>
<span class="tok-w">          </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Unsupported title formatting&quot;</span><span class="tok-p">),</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-p">})</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_header_setext_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span>This is a header
================

This is a subheader
-------------------

This is a subsubheader
~~~~~~~~~~~~~~~~~~~~~~

This is a subsubsubheader
^^^^^^^^^^^^^^^^^^^^^^^^^
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect3">
<h4 id="_this_is_a_header">This is a header</h4>
<div class="sect4">
<h5 id="_this_is_a_subheader">This is a subheader</h5>
<div class="sect5">
<h6 id="_this_is_a_subsubheader">This is a subsubheader</h6>
<div class="sect6">
<h7 id="_this_is_a_subsubsubheader">This is a subsubsubheader</h7>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="setext_header_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">h1</span><span class="tok-p">&gt;</span>This is a header<span class="tok-p">&lt;/</span><span class="tok-nt">h1</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h2</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subheader&quot;</span><span class="tok-p">&gt;</span>This is a subheader<span class="tok-p">&lt;/</span><span class="tok-nt">h2</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h3</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subsubheader&quot;</span><span class="tok-p">&gt;</span>This is a subsubheader<span class="tok-p">&lt;/</span><span class="tok-nt">h3</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h4</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subsubsubheader&quot;</span><span class="tok-p">&gt;</span>This is a subsubsubheader<span class="tok-p">&lt;/</span><span class="tok-nt">h4</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Auch Titel im ATX Format werden erkannt.</p>
</div>
<div id="unittest_header_atx_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span>= This is a header

== This is a subheader

=== This is a subsubheader

==== This is a subsubsubheader
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="sect3">
<h4 id="_this_is_a_header_2">This is a header</h4>
<div class="sect4">
<h5 id="_this_is_a_subheader_2">This is a subheader</h5>
<div class="sect5">
<h6 id="_this_is_a_subsubheader_2">This is a subsubheader</h6>
<div class="sect6">
<h7 id="_this_is_a_subsubsubheader_2">This is a subsubsubheader</h7>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="atx_header_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">h1</span><span class="tok-p">&gt;</span>This is a header<span class="tok-p">&lt;/</span><span class="tok-nt">h1</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h2</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subheader&quot;</span><span class="tok-p">&gt;</span>This is a subheader<span class="tok-p">&lt;/</span><span class="tok-nt">h2</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h3</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subsubheader&quot;</span><span class="tok-p">&gt;</span>This is a subsubheader<span class="tok-p">&lt;/</span><span class="tok-nt">h3</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;</span><span class="tok-nt">h4</span> <span class="tok-na">id</span><span class="tok-o">=</span><span class="tok-s">&quot;_this_is_a_subsubsubheader&quot;</span><span class="tok-p">&gt;</span>This is a subsubsubheader<span class="tok-p">&lt;/</span><span class="tok-nt">h4</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_absätze">Absätze</h5>
<div class="paragraph">
<p>Absätze sind die meistgenutzen Elemente in Texten. Ihre Verwendung
ergibt sich ganz natürlich. Alles was an einem Stück geschrieben wurde
(und kein anderer Block ist) ist ein Absatz. Absätze werden durch eine
oder mehrere Leerzeilen getrennt.</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>paragraph = ${ (!empty_lines ~ !EOI ~ ANY)+ }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">paragraph</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_paragraph</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">)),</span></code></pre>
</div>
</div>
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse_paragraph</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">AsciidocParser</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_parser</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">out</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">other_inline</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">other_list_inline</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_element</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Text</span><span class="tok-p">),</span>
<span class="tok-w">          </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">subelement</span><span class="tok-p">)),</span>
<span class="tok-w">          </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">subelement</span><span class="tok-p">),</span>
<span class="tok-w">        </span><span class="tok-p">});</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-n">out</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_paragraph</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">from_element</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Paragraph</span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parse_paragraph</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">())</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">child</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">child</span><span class="tok-p">.</span><span class="tok-n">add_offset</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">base</span><span class="tok-p">))</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-n">base</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_textformattierung">Textformattierung</h5>
<div class="paragraph">
<p>Innerhalb von Blöcken will man oft Texte vormattieren. Folgende
Formatierungen werden unterstützt:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Fett</strong></p>
</div>
<div id="unittest_inline_bold_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span>Some text is *bold*.
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>strong = ${ &quot;*&quot; ~ (!&quot;*&quot; ~ linechar)+ ~ &quot;*&quot; }</code></pre>
</div>
</div>
</div>
</details></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Some text is <strong>bold</strong>.</p>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="inline_bold_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Some text is <span class="tok-p">&lt;</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span>bold<span class="tok-p">&lt;/</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span>.<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>Kursiv</em></p>
</div>
<div id="unittest_inline_italic_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span>Some text is _italic_.
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>emphasized = ${ &quot;_&quot; ~ (!&quot;_&quot; ~ linechar)+ ~ &quot;_&quot; }</code></pre>
</div>
</div>
</div>
</details></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Some text is <em>italic</em>.</p>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="inline_italic_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Some text is <span class="tok-p">&lt;</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span>italic<span class="tok-p">&lt;/</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span>.<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Monospaced</code></p>
</div>
<div id="unittest_inline_monospaced_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span>Some text is `monospaced`.
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>monospaced = ${ inline_anchor* ~ ((&quot;+&quot; ~ (!&quot;+&quot; ~ linechar)+ ~ &quot;+&quot;) | (&quot;`&quot; ~ (!&quot;`&quot; ~ linechar)+ ~ &quot;`&quot;)) }</code></pre>
</div>
</div>
</div>
</details></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Some text is <code>monospaced</code>.</p>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="inline_monospaced_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Some text is <span class="tok-p">&lt;</span><span class="tok-nt">code</span><span class="tok-p">&gt;</span>monospaced<span class="tok-p">&lt;/</span><span class="tok-nt">code</span><span class="tok-p">&gt;</span>.<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_inline</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">link</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_link</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">xref</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_xref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">monospaced</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">strong</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">emphasized</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Styled</span><span class="tok-p">).</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;style&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">monospaced</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;monospaced&quot;</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">strong</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;strong&quot;</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">emphasized</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;em&quot;</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;not_supported&quot;</span><span class="tok-p">,</span>
<span class="tok-w">          </span><span class="tok-p">}),</span>
<span class="tok-w">        </span><span class="tok-p">});</span>

<span class="tok-w">        </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">concat_elements</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">linechar</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">          </span><span class="tok-p">}),</span>
<span class="tok-w">          </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-p">};</span>
<span class="tok-w">        </span><span class="tok-n">element</span>
<span class="tok-w">          </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">          </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">subelement</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_anchor</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline_anchor</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">            </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">          </span><span class="tok-p">})</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_listen">Listen</h5>
<div class="paragraph">
<p>In Texten bieten sich Listen für alle Arten von Aufzählungen an.
Generell unterscheiden wir drei Arten von Listen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unnummerierte Listen</p>
</li>
<li>
<p>Nummerierte Listen</p>
</li>
<li>
<p>Benannte Listen</p>
</li>
</ul>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>list = { bullet_list | numbered_list | labeled_list }</code></pre>
</div>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>list_element = ${
  (
    list_paragraph |
    (continuation ~ delimited_block)
  )+
}
list_paragraph = ${ (inline | other_list_inline)+ }
other_list_inline = @{ (!empty_lines ~ !EOI ~ !inline ~ !(NEWLINE ~ (bullet | number_bullet)) ~ !(continuation ~ delimited_block) ~ ANY)+ }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">extract_inner_rule</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span>
<span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">list_paragraph</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_paragraph</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">)),</span>
<span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">other_list_inline</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">from_element</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Text</span><span class="tok-p">)),</span>
<span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">continuation</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span></code></pre>
</div>
</div>
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>continuation = { NEWLINE ~ &quot;+&quot; ~ NEWLINE }</code></pre>
</div>
</div>
</div>
</details>
<div class="sect5">
<h6 id="_unnummerierte_listen">Unnummerierte Listen</h6>
<div class="paragraph">
<p>Unnummerierte Listen können mit <code>*</code> oder mit <code>-</code> erzeugt werden. Um eine
weitere Einrückung zu erzeugen kann man mehrere Punkte hintereinander
hängen (z.B. <code>**</code>).</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>bullet = { (&quot;*&quot;+ | &quot;-&quot;+) }
bullet_list_element = { bullet ~ list_element ~ (NEWLINE | EOI) }
bullet_list = { bullet_list_element+ }</code></pre>
</div>
</div>
</div>
</details>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_bullet_list_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span>* This
* is
* a
* list
** with subpoints
*** and deeper
**** nested subpoints
* Next normal point
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>This</p>
</li>
<li>
<p>is</p>
</li>
<li>
<p>a</p>
</li>
<li>
<p>list</p>
<div class="ulist">
<ul>
<li>
<p>with subpoints</p>
<div class="ulist">
<ul>
<li>
<p>and deeper</p>
<div class="ulist">
<ul>
<li>
<p>nested subpoints</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Next normal point</p>
</li>
</ul>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="bullet_list_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>This<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>is<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>a<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>list<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>with subpoints<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>and deeper<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
                <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>nested subpoints<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Next normal point<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_bullet_list_dashes_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span>- This
- is
- a
- list
-- with subpoints
--- and deeper
---- nested subpoints
- Next normal point
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>This</p>
</li>
<li>
<p>is</p>
</li>
<li>
<p>a</p>
</li>
<li>
<p>list&#8201;&#8212;&#8201;with subpoints
--- and deeper
---- nested subpoints</p>
</li>
<li>
<p>Next normal point</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">bullet_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_children</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">(),</span>
<span class="tok-w">  </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">).</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">List</span><span class="tok-p">(</span><span class="tok-n">ListType</span><span class="tok-p">::</span><span class="tok-n">Bullet</span><span class="tok-p">)),</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">,</span>
<span class="tok-p">)),</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect5">
<h6 id="_nummerierte_listen">Nummerierte Listen</h6>
<div class="paragraph">
<p>Manchmal möchte man die genaue Reihenfolge explizit vorgeben. In
diesem Fall verwendet man eine nummerierte Liste. Wir können die
Nummeriungspunkte mit <code>.</code> darstellen.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>number_bullet = { &quot;.&quot;+ }
number_bullet_list_element = { number_bullet ~ list_element ~ (NEWLINE | EOI) }
numbered_list = { number_bullet_list_element+ }</code></pre>
</div>
</div>
</div>
</details>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_numbered_list_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span>. This
. is
. a
.. nested
. numbered list
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="olist arabic">
<ol class="arabic">
<li>
<p>This</p>
</li>
<li>
<p>is</p>
</li>
<li>
<p>a</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>nested</p>
</li>
</ol>
</div>
</li>
<li>
<p>numbered list</p>
</li>
</ol>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="numbered_list_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">ol</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;arabic&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>This<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>is<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>a<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">ol</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;loweralpha&quot;</span> <span class="tok-na">type</span><span class="tok-o">=</span><span class="tok-s">&quot;a&quot;</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>nested<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">ol</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>numbered list<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">ol</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">numbered_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_children</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">(),</span>
<span class="tok-w">  </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">).</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">List</span><span class="tok-p">(</span><span class="tok-n">ListType</span><span class="tok-p">::</span><span class="tok-n">Number</span><span class="tok-p">)),</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">,</span>
<span class="tok-p">)),</span>
<span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">bullet_list_element</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">number_bullet_list_element</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">bullet</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">number_bullet</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">ListItem</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">))</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">list_element</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_children</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">EOI</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">sub</span><span class="tok-p">));</span>
<span class="tok-w">        </span><span class="tok-n">base</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}),</span>
<span class="tok-p">),</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect5">
<h6 id="_abhacklisten">Abhacklisten</h6>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect5">
<h6 id="_benannte_listen_description_lists">Benannte Listen (Description Lists)</h6>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>label_bullet = { (!&quot;::&quot; ~ linechar) ~ &quot;::&quot; }
labeled_list = { (label_bullet ~ list_element)+ }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_links">Links</h5>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>link = ${ url ~ inline_attribute_list }
url = ${proto ~ &quot;://&quot; ~ path}
proto = ${ (&quot;http&quot; ~ &quot;s&quot;?) |
           &quot;mailto&quot; |
           &quot;git&quot;
         }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_link</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Link</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;url&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">          </span><span class="tok-p">});</span>
<span class="tok-w">          </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">next</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"> </span><span class="tok-c1">// TODO Fehler möglich?</span>
<span class="tok-w">          </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;protocol&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">          </span><span class="tok-p">})</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_attribute_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline_attribute_list</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">        </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_child</span><span class="tok-p">(</span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">)),</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_querverweise">Querverweise</h5>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>xref = !{ &quot;&lt;&lt;&quot; ~ identifier ~ (NEWLINE? ~ &quot;,&quot; ~ NEWLINE? ~ word+)? ~ &quot;&gt;&gt;&quot; }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_xref</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">fold</span><span class="tok-p">(</span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">XRef</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">identifier</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;id&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">        </span><span class="tok-p">}),</span>
<span class="tok-w">        </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">word</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">});</span>

<span class="tok-w">  </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">concat_elements</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">word</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot; &quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">      </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">}),</span>
<span class="tok-w">    </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_fußnoten">Fußnoten</h5>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>footnote = { &quot;footnote:&quot; ~ inline_attribute_list }
footnoteref = { &quot;footnoteref:&quot; ~ inline_attribute_list }

quoted = @{ inline_attribute_list ~ &quot;#&quot; ~ (!&quot;#&quot; ~ linechar)+ ~ &quot;#&quot; }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bilder">Bilder</h5>
<div class="paragraph">
<p>Um Bilder einzubinden verwenden wir die übliche Syntax für Macros mit dem Schlüsselwort <em>image</em>.</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>image_block = { anchor* ~ image }
image = { &quot;image::&quot; ~ (url | path) ~ inline_attribute_list }</code></pre>
</div>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="asciidoc_element_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">image_block</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">process_image</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)),</span></code></pre>
</div>
</div>
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_image</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">().</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">flatten</span><span class="tok-p">().</span><span class="tok-n">fold</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">).</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Image</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-n">base</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;path&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">        </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-p">}),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">path</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;path&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">        </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-p">}),</span>
<span class="tok-w">      </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">inline_attribute_list</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inline_attribute_list</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">get_attribute</span><span class="tok-p">(</span><span class="tok-s">&quot;opts&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-s">&quot;inline&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">get_attribute</span><span class="tok-p">(</span><span class="tok-s">&quot;path&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">add_attribute</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">          </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">        </span><span class="tok-p">}),</span>
<span class="tok-w">        </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">().</span><span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-fm">format!</span><span class="tok-p">(</span>
<span class="tok-w">          </span><span class="tok-s">&quot;couldn&#39;t read content of image file {} ({})&quot;</span><span class="tok-p">,</span>
<span class="tok-w">          </span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span>
<span class="tok-w">        </span><span class="tok-p">)),</span>
<span class="tok-w">      </span><span class="tok-p">},</span>
<span class="tok-w">      </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;There was no path of inline image defined&quot;</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">_</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_tabellen">Tabellen</h5>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>delimited_table = {
  PUSH(&quot;|&quot; ~ &quot;=&quot;{3,}) ~ NEWLINE ~
  delimited_inner ~
  NEWLINE ~ POP ~ &amp;(NEWLINE | EOI)
}

table_inner = {
  (table_cell ~ NEWLINE*)+
}

table_cell = {
  &quot;|&quot; ~ table_cell_content
}

table_cell_content = {
  (!&quot;|&quot; ~ ANY)*
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_simple_table_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span>|===
| Col1 | Col2
| Cel1 | Cel2
| Cel3 | Cel4
|===
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Col1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Col2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cel1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cel2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cel3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cel4</p></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="simple_table_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">table</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;tableblock frame-all grid-all stretch&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">colgroup</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">col</span> <span class="tok-na">style</span><span class="tok-o">=</span><span class="tok-s">&quot;width: 50%;&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">col</span> <span class="tok-na">style</span><span class="tok-o">=</span><span class="tok-s">&quot;width: 50%;&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">colgroup</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">tbody</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Col1<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Col2<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Cel1<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Cel2<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Cel3<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Cel4<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">tbody</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">table</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_formated_table_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span>[cols=&quot;1,a&quot;]
|===
|
Here inline *markup* _text_ is rendered specially

But paragraphs

* or
** Lists
** are not handled as such
|
In this cell *markup* _text_ is handeled specially

We can even have multiple paragraphs

* List
** with
** multiple
* entries
|===
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here inline <strong>markup</strong> <em>text</em> is rendered specially</p>
<p class="tableblock">But paragraphs</p>
<p class="tableblock">* or
<strong> Lists
</strong> are not handled as such</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In this cell <strong>markup</strong> <em>text</em> is handeled specially</p>
</div>
<div class="paragraph">
<p>We can even have multiple paragraphs</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List</p>
<div class="ulist">
<ul>
<li>
<p>with</p>
</li>
<li>
<p>multiple</p>
</li>
</ul>
</div>
</li>
<li>
<p>entries</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="formated_table_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">table</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;tableblock frame-all grid-all stretch&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">colgroup</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">col</span> <span class="tok-na">style</span><span class="tok-o">=</span><span class="tok-s">&quot;width: 50%;&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">col</span> <span class="tok-na">style</span><span class="tok-o">=</span><span class="tok-s">&quot;width: 50%;&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">colgroup</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">tbody</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Here inline <span class="tok-p">&lt;</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span>markup<span class="tok-p">&lt;/</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span> <span class="tok-p">&lt;</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span>text<span class="tok-p">&lt;/</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span> is rendered specially

But paragraphs

* or
** Lists
** are not handled as such<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>In this cell <span class="tok-p">&lt;</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span>markup<span class="tok-p">&lt;/</span><span class="tok-nt">strong</span><span class="tok-p">&gt;</span> <span class="tok-p">&lt;</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span>text<span class="tok-p">&lt;/</span><span class="tok-nt">em</span><span class="tok-p">&gt;</span> is handeled specially<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>We can even have multiple paragraphs<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>List<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
                <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>with<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
                <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>multiple<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
              <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>entries<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
          <span class="tok-p">&lt;/</span><span class="tok-nt">li</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&lt;/</span><span class="tok-nt">ul</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;/</span><span class="tok-nt">td</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">tr</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">tbody</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">table</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="delimited_block_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_table</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">process_inner_table</span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Table</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">),</span></code></pre>
</div>
</div>
<div id="asciidoc_parser_functions" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#[derive(Debug, PartialEq)]</span>
<span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">ColKind</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nb">Default</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Asciidoc</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, PartialEq)]</span>
<span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">ColumnFormat</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">length</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ColKind</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse_column_format</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ColumnFormat</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">ColumnFormat</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">length</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">match</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-s">&quot;a&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">ColKind</span><span class="tok-p">::</span><span class="tok-n">Asciidoc</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">ColKind</span><span class="tok-p">::</span><span class="tok-nb">Default</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse_columns_format</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ColumnFormat</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">input</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">input</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">parse_column_format</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">()))</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">()</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse_columns_format_from_content</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ColumnFormat</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">input</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">unwrap_or</span><span class="tok-p">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-sc">&#39;|&#39;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">_</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">ColumnFormat</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">length</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ColKind</span><span class="tok-p">::</span><span class="tok-nb">Default</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">()</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_inner_table</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">find</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_inner</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">col_format</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">get_attribute</span><span class="tok-p">(</span><span class="tok-s">&quot;cols&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">fmt</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">parse_columns_format</span><span class="tok-p">(</span><span class="tok-n">fmt</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">parse_columns_format_from_content</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-p">};</span>

<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">attributes</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Attribute</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-p">});</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">process_table_content</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">col_format</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-n">base</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_table_content</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">col_format</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ColumnFormat</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">AsciidocParser</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">table_inner</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">ast</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">ElementSpan</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">(</span><span class="tok-fm">format!</span><span class="tok-p">(</span><span class="tok-s">&quot;could not parse cell: {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)),</span>
<span class="tok-w">        </span><span class="tok-n">source</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">input</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">start</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">end</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">start_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">start_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">end_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">end_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">children</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">        </span><span class="tok-n">positional_attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">        </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">      </span><span class="tok-p">}];</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">};</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">cells</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span>

<span class="tok-w">  </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fmt</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">().</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-n">col_format</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">cycle</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">cells</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">process_table_cell</span><span class="tok-p">(</span><span class="tok-n">subelement</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fmt</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">))</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">rows</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">len</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">col_format</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">();</span>
<span class="tok-w">  </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">chunk</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">cells</span><span class="tok-p">.</span><span class="tok-n">chunks</span><span class="tok-p">(</span><span class="tok-n">len</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">rows</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">ElementSpan</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-p">::</span><span class="tok-n">TableRow</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">source</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">start</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">end</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">start_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">start_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">end_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">end_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">children</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">chunk</span><span class="tok-p">.</span><span class="tok-n">to_vec</span><span class="tok-p">(),</span>
<span class="tok-w">      </span><span class="tok-n">positional_attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">      </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">    </span><span class="tok-p">})</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-n">rows</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">process_table_cell</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Pair</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">asciidoc</span><span class="tok-p">::</span><span class="tok-n">Rule</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">fmt</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">ColumnFormat</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">,</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">set_span</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">element</span><span class="tok-p">).</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">TableCell</span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">element</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">find</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sub</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-p">.</span><span class="tok-n">as_rule</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">table_cell_content</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">();</span>

<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">fmt</span><span class="tok-p">.</span><span class="tok-n">kind</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">ColKind</span><span class="tok-p">::</span><span class="tok-n">Asciidoc</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">AsciidocParser</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">asciidoc</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span>

<span class="tok-w">      </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">elements</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span>

<span class="tok-w">      </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">process_element</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">elements</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">element</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-n">elements</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-n">ColKind</span><span class="tok-p">::</span><span class="tok-nb">Default</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>
<span class="tok-w">      </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Paragraph</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parse_paragraph</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">);</span>

<span class="tok-w">      </span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">base</span><span class="tok-p">]</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">};</span>

<span class="tok-w">  </span><span class="tok-n">base</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_kommentare">Kommentare</h5>
<div class="paragraph">
<p>Manchmal möchte man nur einen Kommentar für den Author eines Textes
(also meistens für sich selbst) festhalten, ohne dass dieser am Ende im
Dokument für den Leser erscheint. Asciidoc biete dazu Kommentare an.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="inline_elements" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>// TODO Damit werden keine Kommentare zu Beginn eines Paragraphen angezeigt
comment = { NEWLINE ~ &quot;//&quot; ~ (!NEWLINE ~ ANY)* ~ &amp;NEWLINE }</code></pre>
</div>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>&lt;&lt;delimited_block_template|
    blocktype := &quot;comment&quot;,
    delimiter := &quot;/&quot; &gt;&gt;</code></pre>
</div>
</div>
<div id="delimited_block_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_comment</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Comment</span><span class="tok-p">,</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_quellcode_blöcke">Quellcode Blöcke</h5>
<div class="paragraph">
<p>Gerade Markup-Formate wie Asciidoc bieten sich an, um Quellcode Blöcke
einzubinden, da sie&#8201;&#8212;&#8201;genauso wie Quelltext&#8201;&#8212;&#8201;in reinen Textdateien
abgespeichert werden.</p>
</div>
<div class="paragraph">
<p>Sie können als abgetrennte Blöcke mit <code>-</code> oder <code>.</code> gekennzeichnet
werden.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>&lt;&lt;delimited_block_template|
    blocktype := &quot;literal&quot;,
    delimiter := &quot;.&quot; &gt;&gt;

&lt;&lt;delimited_block_template|
    blocktype := &quot;source&quot;,
    delimiter := &quot;-&quot; &gt;&gt;</code></pre>
</div>
</div>
<div id="delimited_block_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_source</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_literal</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Listing</span><span class="tok-p">,</span></code></pre>
</div>
</div>
</div>
</details>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_sourcecode_block_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span>[source, bash]
----
echo &quot;hello world!&quot;
----
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">&quot;hello world!&quot;</span></code></pre>
</div>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="sourceblock_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;listingblock&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">pre</span><span class="tok-p">&gt;</span>echo &quot;hello world!&quot;<span class="tok-p">&lt;/</span><span class="tok-nt">pre</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_sourcecode_block_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span>[source, bash]
....
echo &quot;hello world!&quot;
....
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s2">&quot;hello world!&quot;</span></code></pre>
</div>
</div>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="sourceblock_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;listingblock&quot;</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">pre</span><span class="tok-p">&gt;</span>echo &quot;hello world!&quot;<span class="tok-p">&lt;/</span><span class="tok-nt">pre</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_beispiel_blöcke">Beispiel Blöcke</h5>
<div class="paragraph">
<p>Manchmal möchte man Inhalte als Beispiel kennzeichnen. Um das zu tun,
packt man den entsprechenden Inhalt in einen abgetrennten Block aus <code>=</code>
Zeichen.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>&lt;&lt;delimited_block_template|
    blocktype := &quot;example&quot;,
    delimiter := &quot;=&quot; &gt;&gt;

delimited_verse = { &quot;verse&quot; } // TODO</code></pre>
</div>
</div>
<div id="delimited_block_rules" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-n">Rule</span><span class="tok-p">::</span><span class="tok-n">delimited_example</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">BlockType</span><span class="tok-p">::</span><span class="tok-n">Example</span><span class="tok-p">,</span></code></pre>
</div>
</div>
</div>
</details>
<div class="sect5">
<h6 id="_einklappbare_blöcke">Einklappbare Blöcke</h6>
<div class="paragraph">
<p>Einklappbare Blöcke sind nützlich, wenn man ergaenzende Informationen
nur bei Bedarf anzeigen möchte. So kann man die Informationen einbinden,
ohne dass der normale Leser überfordert wird.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div id="unittest_collapsible_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span>[%collapsible]
====
Additional Information, that will only be shown on demand.
====
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><details>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>Additional Information, that will only be shown on demand.</p>
</div>
</div>
</details>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="collapsible_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">details</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">summary</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;title&quot;</span><span class="tok-p">&gt;</span>Details<span class="tok-p">&lt;/</span><span class="tok-nt">summary</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;paragraph&quot;</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>Additional Information, that will only be shown on demand.<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">details</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Blöcke können auch standardmäßig geöffnet sein.</p>
</div>
<div id="unittest_collapsible_open_input" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="asciidoc"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span>[%collapsible%open]
====
This Information is visible by default.
====
</pre></div></td></tr></table></div></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><details open>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>This Information is visible by default.</p>
</div>
</div>
</details>
<details>
<summary class="title">Html Output</summary>
<div class="content">
<div id="collapsible_open_html_output" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span></span><span class="tok-p">&lt;</span><span class="tok-nt">details</span> <span class="tok-na">open</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">summary</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;title&quot;</span><span class="tok-p">&gt;</span>Details<span class="tok-p">&lt;/</span><span class="tok-nt">summary</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;content&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;</span><span class="tok-nt">div</span> <span class="tok-na">class</span><span class="tok-o">=</span><span class="tok-s">&quot;paragraph&quot;</span><span class="tok-p">&gt;</span>
      <span class="tok-p">&lt;</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>This Information is visible by default.<span class="tok-p">&lt;/</span><span class="tok-nt">p</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span>
  <span class="tok-p">&lt;/</span><span class="tok-nt">div</span><span class="tok-p">&gt;</span>
<span class="tok-p">&lt;/</span><span class="tok-nt">details</span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
</details></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_andere_dokumente_einbinden">Andere Dokumente einbinden</h5>
<div class="paragraph">
<p>TODO</p>
</div>
<div id="blocks" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>include_macro = { &quot;include::&quot; ~ path ~ inline_attribute_list }</code></pre>
</div>
</div>
<div id="generic_pegs" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="pest"><span></span>// TODO Should all unicode letters be matched? Instead of just ascii?
identifier = @{ (ASCII_ALPHANUMERIC | &quot;_&quot;) ~ (ASCII_ALPHANUMERIC | &quot;_&quot; | &quot;-&quot; | &quot;.&quot;)* }

word = @{ (LETTER | NUMBER | &quot;_&quot; | &quot;-&quot;)+ }
path = @{ (LETTER | NUMBER | &quot;_&quot; | &quot;-&quot; | &quot;.&quot; | &quot;/&quot; | &quot;~&quot; )+ }

linechar = { (!NEWLINE ~ ANY) }

line = { linechar+ ~ ( &amp;NEWLINE | &amp;EOI) }

empty_lines = _{ NEWLINE{2, } | (NEWLINE ~ EOI) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in asciidoctrine.adoc - include::src/json-syntax.adoc[]</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_json">Json</h4>
<div class="listingblock">
<div class="title">src/reader/json.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">ast</span><span class="tok-p">::</span><span class="tok-o">*</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">util</span><span class="tok-p">::{</span><span class="tok-n">Env</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-p">;</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">JsonReader</span><span class="tok-w"> </span><span class="tok-p">{}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">JsonReader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">JsonReader</span><span class="tok-w"> </span><span class="tok-p">{}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">Reader</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">JsonReader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_args</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">Opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">serde_json</span><span class="tok-p">::</span><span class="tok-n">from_str</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">ast</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="output-format">Ausgabeformate</h3>
<div class="paragraph">
<p>Der ganze Sinn des Programmes besteht darin, aus einer einzigen Datenquelle
verschiedene Ausgabedateien zu erzeugen. Diese können noch eigenen
Vorstellungen oder Vorgaben formatiert und abgelegt werden. <code>asciidoctrine</code>
unterstützt verschiedene Ausgabeformate, die in den folgenden Abschnitten
beschrieben werden (sowie wie man Formatierungsanpassungen vornehmen kann)</p>
</div>
<div class="listingblock">
<div class="title">src/writer/mod.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">html</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">docx</span><span class="tok-p">;</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">mod</span><span class="tok-w"> </span><span class="tok-nn">json</span><span class="tok-p">;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in asciidoctrine.adoc - include::src/output/html5.adoc[]</p>
</div>
<div class="sect3">
<h4 id="html5">Html5</h4>
<div class="paragraph">
<p>Html ist <em>das</em> Format für Webseiten.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in asciidoctrine.adoc - include::src/output/docbook.adoc[]
Unresolved directive in asciidoctrine.adoc - include::src/output/manpage.adoc[]
Unresolved directive in asciidoctrine.adoc - include::src/output/pdf.adoc[]
Unresolved directive in asciidoctrine.adoc - include::src/output/json-ast.adoc[]</p>
</div>
</div>
<div class="sect3">
<h4 id="_json_2">Json</h4>
<div class="listingblock">
<div class="title">src/writer/json.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">ast</span><span class="tok-p">::</span><span class="tok-o">*</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::{</span><span class="tok-n">options</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">io</span><span class="tok-p">;</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">JsonWriter</span><span class="tok-w"> </span><span class="tok-p">{}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">JsonWriter</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">JsonWriter</span><span class="tok-w"> </span><span class="tok-p">{}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">io</span><span class="tok-p">::</span><span class="tok-n">Write</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">Writer</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">JsonWriter</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AST</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_args</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">T</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">out</span><span class="tok-p">.</span><span class="tok-n">write_all</span><span class="tok-p">(</span><span class="tok-n">serde_json</span><span class="tok-p">::</span><span class="tok-n">to_string_pretty</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">ast</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">as_bytes</span><span class="tok-p">())</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">out</span><span class="tok-p">.</span><span class="tok-n">flush</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(())</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asciidoctrine_in_andere_programme_einbinden">asciidoctrine in andere Programme einbinden</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
<div class="sect2">
<h3 id="cmd-api">Aufruf auf der Kommandozeile</h3>
<div class="paragraph">
<p>Der einfachste Weg asciidoctrine in ein anderes Programm einzubinden ist es über der Kommandozeile aufzurufen.</p>
</div>
<div class="listingblock">
<div class="title">src/options.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">clap</span><span class="tok-p">::{</span><span class="tok-n">Parser</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ValueEnum</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">path</span><span class="tok-p">::</span><span class="tok-n">PathBuf</span><span class="tok-p">;</span>

<span class="tok-sd">/// Parse a single key-value pair</span>
<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse_key_val</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">U</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">U</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span>
<span class="tok-k">where</span>
<span class="tok-w">  </span><span class="tok-n">T</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">std</span><span class="tok-p">::</span><span class="tok-kt">str</span><span class="tok-p">::</span><span class="tok-n">FromStr</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">U</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">std</span><span class="tok-p">::</span><span class="tok-kt">str</span><span class="tok-p">::</span><span class="tok-n">FromStr</span><span class="tok-p">,</span>
<span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">pos</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">find</span><span class="tok-p">(</span><span class="tok-sc">&#39;=&#39;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">ok_or_else</span><span class="tok-p">(</span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-fm">format!</span><span class="tok-p">(</span><span class="tok-s">&quot;invalid KEY=value: no `=` found in `{}`&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">))</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">[</span><span class="tok-o">..</span><span class="tok-n">pos</span><span class="tok-p">]</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">or_else</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">_</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-fm">format!</span><span class="tok-p">(</span><span class="tok-s">&quot;couldn&#39;t parse key in `{}`&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">)))</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">[</span><span class="tok-n">pos</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-p">]</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-n">or_else</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">_</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-fm">format!</span><span class="tok-p">(</span><span class="tok-s">&quot;couldn&#39;t parse value in `{}`&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">)))</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-nb">Ok</span><span class="tok-p">((</span><span class="tok-n">key</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">))</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, ValueEnum, Debug)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">Reader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Asciidoc</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Json</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, ValueEnum, Debug)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">Writer</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Html5</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Docbook</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Pdf</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Json</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Docx</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-c1">// The asciidoc output makes it possible</span>
<span class="tok-w">  </span><span class="tok-c1">// to use this tool as a preprocessor for</span>
<span class="tok-w">  </span><span class="tok-c1">// other asciidoc tools while it is maturing</span>
<span class="tok-w">  </span><span class="tok-n">Asciidoc</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Parser, Debug)]</span>
<span class="tok-cp">#[clap(author, version, about, long_about = None)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">Opts</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(short = &#39;r&#39;, long = </span><span class="tok-s">&quot;reader-format&quot;</span><span class="tok-cp">, default_value_t = Reader::Asciidoc)]</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(value_enum)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">readerfmt</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Reader</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(short = &#39;w&#39;, long = </span><span class="tok-s">&quot;writer-format&quot;</span><span class="tok-cp">, default_value_t = Writer::Html5)]</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(value_enum)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">writerfmt</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Writer</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(long)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">dry_run</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">bool</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(short = &#39;e&#39;, long = </span><span class="tok-s">&quot;extension&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">extensions</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(long)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">template</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">PathBuf</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(long)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">stylesheet</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">PathBuf</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(short = &#39;a&#39;, long = </span><span class="tok-s">&quot;attribute&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(value_parser = parse_key_val::&lt;String, String&gt;, number_of_values = 1)]</span>
<span class="tok-w">  </span><span class="tok-n">defines</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(name = </span><span class="tok-s">&quot;FILE&quot;</span><span class="tok-cp">)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">PathBuf</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[clap(short = &#39;o&#39;)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">PathBuf</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">from_args</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Opts</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Opts</span><span class="tok-p">::</span><span class="tok-n">parse</span><span class="tok-p">()</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extensions">asciidoctrine erweitern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Man kann <code>asciidoctrine</code> über eine api Schnittstelle erweitern. Dazu werden für alle wichtigen Funktionen Schnittstellen definiert, welche von der jeweiligen Erweiterung implementiert werden müssen.</p>
</div>
<div class="sect2">
<h3 id="reader">Neue Datenformate einlesen</h3>
<div class="paragraph">
<p>Jedes Eingabeformat muss zunächst in einen <a href="#ast">Abstract Syntax Tree</a> ungewandelt werden um von asciidoctrine verarebitet werden zu können. Auch alle intern unterstützten Dateiformate implementieren die gleiche Schnittstelle.</p>
</div>
<div id="interfaces" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">trait</span><span class="tok-w"> </span><span class="tok-n">Reader</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">parse</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">util</span><span class="tok-p">::</span><span class="tok-n">Env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extension">Den AST verarbeiten/modifizieren</h3>
<div class="paragraph">
<p>Manchmal will man den <a href="#ast">Abstract Syntax Tree</a> verarbeiten und daraus Informationen nutzen (<a href="#../lisi.adoc#">lisi</a> verwendet ihn z.B. um daraus Quelltext-Dateien zu extrahieren). Das ermöglicht sehr viele Anwendungsfälle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Daten extrahieren und Prüfungen oder Statistiken damit durchführen</p>
</li>
<li>
<p>Rechtschreibprüfung durchführen</p>
</li>
<li>
<p>Mehrere Dokumente vereinen</p>
</li>
<li>
<p>etc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Für alle diese Funktionen definieren wir eine Schnittstelle welche einen AST einließt und am Ende einen AST ausgibt. Wie er zwischendurch verarbeitet wird und ob er modifiziert wird bleibt vollständig der Erweiterung überlassen.</p>
</div>
<div id="interfaces" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">trait</span><span class="tok-w"> </span><span class="tok-n">Extension</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-c1">// TODO Options (Kann auch über Attributes in AST gemacht werden)</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">transform</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">anyhow</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writer">Neue Ausgabeformate unterstützen</h3>
<div class="paragraph">
<p>Um ein weiteres Ausgabeformat zu implementieren muss die entsprechende Schnittstelle implementiert werden. Sie konsumiert einen <a href="#ast">AST</a> und ist dafür verantwortlich eine Datei zu erstellen, welche das Ausgabeformat verwendet.</p>
</div>
<div id="interfaces" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">trait</span><span class="tok-w"> </span><span class="tok-n">Writer</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">io</span><span class="tok-p">::</span><span class="tok-n">Write</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-c1">// TODO Result zurückgeben mit Fehler oder Liste der Geschriebenen Dateien</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AST</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">T</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ast">Der Abstract Syntax Tree</h3>
<div class="paragraph">
<p>Alle Schnittstellen basieren auf der gleichen Datenstrucktur. Diese bildet ein Dokument vollständig ab.</p>
</div>
<div class="listingblock">
<div class="title">src/ast.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">serde</span><span class="tok-p">::{</span><span class="tok-n">Deserialize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Serialize</span><span class="tok-p">};</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">elements</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Attribute</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">ast_structs</span><span class="tok-o">&gt;&gt;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div id="ast_structs" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">get_attribute</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;&amp;</span><span class="tok-kt">str</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">attribute</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">attributes</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">attribute</span><span class="tok-p">.</span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">attribute</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span>
<span class="tok-w">          </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">        </span><span class="tok-p">};</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-nb">None</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-nb">Default</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">elements</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">      </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">vec</span><span class="tok-o">!</span><span class="tok-p">[],</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-sd">/// The basic element of a document</span>
<span class="tok-sd">///</span>
<span class="tok-sd">/// This is meant to form a tree of document element.</span>
<span class="tok-sd">/// Every element holds references to its source, it</span>
<span class="tok-sd">/// subelements and the attributes defined on it.</span>
<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-c1">// The source document. Could be empty if</span>
<span class="tok-w">  </span><span class="tok-c1">// e.g. it&#39;s the same as the source of it&#39;s</span>
<span class="tok-w">  </span><span class="tok-c1">// parent</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">source</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-c1">// A string reference to the source</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-c1">// TODO Add start and end point</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">start</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// We count the lines for usage in other tools</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">start_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">start_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">end_line</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">end_col</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">element</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// The subelements of a nodes</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">children</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// The attributes applying to that node and</span>
<span class="tok-w">  </span><span class="tok-sd">/// all children</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">positional_attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">AttributeValue</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// The attributes applying to that node and</span>
<span class="tok-w">  </span><span class="tok-sd">/// all children</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">attributes</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Attribute</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">get_attribute</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;&amp;</span><span class="tok-kt">str</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">attribute</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">attributes</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">attribute</span><span class="tok-p">.</span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">attribute</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span>
<span class="tok-w">          </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">()),</span>
<span class="tok-w">        </span><span class="tok-p">};</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-nb">None</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">add_offset</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">start</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">start_line</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start_line</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">end_line</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start_line</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">start_col</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start_col</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">end_col</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">start_col</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">element</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">base</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">error</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">msg</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">element</span><span class="tok-p">(</span><span class="tok-n">Element</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">()))</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">add_attribute</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">Attribute</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">attributes</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">base</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">add_positional_attribute</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">positional_attributes</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">base</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">add_child</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">ElementSpan</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">base</span><span class="tok-p">.</span><span class="tok-n">children</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">base</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">Element</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Attribute</span><span class="tok-p">(</span><span class="tok-cp">#[serde(borrow)]</span><span class="tok-w"> </span><span class="tok-n">Attribute</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-sd">/// A section of ignored text</span>
<span class="tok-w">  </span><span class="tok-n">Comment</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A text paragraph</span>
<span class="tok-w">  </span><span class="tok-n">Paragraph</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A header section</span>
<span class="tok-w">  </span><span class="tok-n">Title</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">level</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-n">Table</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">List</span><span class="tok-p">(</span><span class="tok-n">ListType</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-n">Image</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Anchor</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// Holds all blocks with special content and the type</span>
<span class="tok-w">  </span><span class="tok-sd">/// TODO Could be done with ExternalContent and all known</span>
<span class="tok-w">  </span><span class="tok-sd">/// Types here direktly</span>
<span class="tok-w">  </span><span class="tok-n">TypedBlock</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">kind</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">BlockType</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-sd">/// Holds content which is not przessed direktly by</span>
<span class="tok-w">  </span><span class="tok-sd">/// asciidoctrine. It can be anything. Outputs or</span>
<span class="tok-w">  </span><span class="tok-sd">/// postprocessors could use or ignore it at their</span>
<span class="tok-w">  </span><span class="tok-sd">/// will (e.g. videos)</span>
<span class="tok-w">  </span><span class="tok-n">ExternalContent</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// Holds a reference to the include statement</span>
<span class="tok-w">  </span><span class="tok-sd">/// and a document inside</span>
<span class="tok-w">  </span><span class="tok-n">IncludeElement</span><span class="tok-p">(</span><span class="tok-n">IncludeElement</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">),</span>

<span class="tok-w">  </span><span class="tok-sd">/// The following variants are inline elements nested</span>
<span class="tok-w">  </span><span class="tok-sd">/// inside a conainer element</span>

<span class="tok-w">  </span><span class="tok-sd">/// Element with a special style. The attributes define the kind of style</span>
<span class="tok-w">  </span><span class="tok-n">Styled</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A chunk of text.</span>
<span class="tok-w">  </span><span class="tok-n">Text</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// An internal reference or link</span>
<span class="tok-w">  </span><span class="tok-n">XRef</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// An external link</span>
<span class="tok-w">  </span><span class="tok-n">Link</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A list item</span>
<span class="tok-w">  </span><span class="tok-n">ListItem</span><span class="tok-p">(</span><span class="tok-kt">u32</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-sd">/// A table row</span>
<span class="tok-w">  </span><span class="tok-n">TableRow</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A table cell</span>
<span class="tok-w">  </span><span class="tok-n">TableCell</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-sd">/// A wrong formatted text or block</span>
<span class="tok-w">  </span><span class="tok-n">Error</span><span class="tok-p">(</span><span class="tok-nb">String</span><span class="tok-p">),</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">ListType</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Bullet</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Number</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">BlockType</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Comment</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Passtrough</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Listing</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Literal</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Sidebar</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Quote</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">Example</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-nb">String</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-o">&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">),</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">AttributeValue</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">as_str</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-n">Ref</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">AttributeValue</span><span class="tok-p">::</span><span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">Attribute</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-cp">#[serde(borrow)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AttributeValue</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-cp">#[derive(Debug, Clone, PartialEq, Deserialize, Serialize)]</span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">IncludeElement</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-cp">#[serde(borrow)]</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-n">inner</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">AST</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Jedes Dokument ist im Großen und Ganzen eine Ansammlung von hintereinander liegenden Strukturelementen (wie Überschriften, Texten, etc). In unserem Fall hat ein Dokument zusätzlich noch Eigenschaften welche ihm zugewiesen werden können.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tmp_implementierung">tmp Implementierung</h2>
<div class="sectionbody">
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>Im Fehlerfall ist es nicht immer gut gleich das Programm zu beenden. Damit der Benutzer dennoch darauf reagieren kann geben wir bei Bedarf log-Meldungen aus. Dazu benötigen wir den entspechenden Crate.</p>
</div>
<div id="crate_usages" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#[macro_use]</span>
<span class="tok-k">extern</span><span class="tok-w"> </span><span class="tok-k">crate</span><span class="tok-w"> </span><span class="tok-n">log</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/util.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">collections</span><span class="tok-p">::</span><span class="tok-n">HashMap</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">fs</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">io</span><span class="tok-p">::{</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ErrorKind</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Write</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">path</span><span class="tok-p">::</span><span class="tok-n">Path</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">process</span><span class="tok-p">::{</span><span class="tok-n">Command</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Stdio</span><span class="tok-p">};</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">trait</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">read_to_string</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">eval</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">interpreter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">// success, Stdout, Stderr</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">Io</span><span class="tok-w"> </span><span class="tok-p">{}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Io</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Io</span><span class="tok-w"> </span><span class="tok-p">{}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">fs_read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">fs</span><span class="tok-p">::</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">)</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Io</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">read_to_string</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">fs_read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Path</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">parent</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">exists</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">fs</span><span class="tok-p">::</span><span class="tok-n">create_dir_all</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">exists</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">old_content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">fs</span><span class="tok-p">::</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">old_content</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">Ok</span><span class="tok-p">(());</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-n">fs</span><span class="tok-p">::</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(())</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">eval</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">interpreter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">eval</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Command</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">interpreter</span><span class="tok-p">)</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">stdin</span><span class="tok-p">(</span><span class="tok-n">Stdio</span><span class="tok-p">::</span><span class="tok-n">piped</span><span class="tok-p">())</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">stderr</span><span class="tok-p">(</span><span class="tok-n">Stdio</span><span class="tok-p">::</span><span class="tok-n">piped</span><span class="tok-p">())</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">stdout</span><span class="tok-p">(</span><span class="tok-n">Stdio</span><span class="tok-p">::</span><span class="tok-n">piped</span><span class="tok-p">())</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">spawn</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-n">eval</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">stdin</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">as_mut</span><span class="tok-p">()</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">ok_or</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">AsciidoctrineError</span><span class="tok-p">::</span><span class="tok-n">Childprocess</span><span class="tok-p">)</span><span class="tok-o">?</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">write_all</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">.</span><span class="tok-n">as_bytes</span><span class="tok-p">())</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">// TODO Wie soll EOF gesendet werden?</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">eval</span><span class="tok-p">.</span><span class="tok-n">wait_with_output</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">success</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-n">status</span><span class="tok-p">.</span><span class="tok-n">success</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">::</span><span class="tok-n">from_utf8</span><span class="tok-p">(</span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-n">stdout</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-n">_</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;Error: Couldn&#39;t decode stdout&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-p">};</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">err</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">::</span><span class="tok-n">from_utf8</span><span class="tok-p">(</span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-n">stderr</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-n">_</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-s">&quot;Error: Couldn&#39;t decode stderr&quot;</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-p">};</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">((</span><span class="tok-n">success</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">err</span><span class="tok-p">))</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">EvalData</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">success</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kt">bool</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">out</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">err</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">add_files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">remove_files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">Cache</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">evaluations</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">EvalData</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Cache</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Cache</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-p">::</span><span class="tok-n">default</span><span class="tok-p">(),</span>
<span class="tok-w">      </span><span class="tok-n">evaluations</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-p">::</span><span class="tok-n">default</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">get_files</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Cache</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">read_to_string</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">).</span><span class="tok-n">ok_or</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">::</span><span class="tok-n">Error</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(</span>
<span class="tok-w">      </span><span class="tok-n">ErrorKind</span><span class="tok-p">::</span><span class="tok-n">NotFound</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-s">&quot;file not found in cache&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-p">))</span><span class="tok-o">?</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">());</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(())</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">eval</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">interpreter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">evaluations</span>
<span class="tok-w">      </span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-p">(</span><span class="tok-n">interpreter</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">()))</span>
<span class="tok-w">    </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">EvalData</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">success</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">out</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">err</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">add_files</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">remove_files</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-p">})</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">remove_files</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">add_files</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-nb">Ok</span><span class="tok-p">((</span><span class="tok-n">success</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">out</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">err</span><span class="tok-p">))</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">      </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">AsciidoctrineError</span><span class="tok-p">::</span><span class="tok-n">Childprocess</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">FakeOutput</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">FakeOutput</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">new</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">files</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-p">::</span><span class="tok-n">default</span><span class="tok-p">(),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">get_files</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">HashMap</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">FakeOutput</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">read_to_string</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">fs_read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">real_path</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Path</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">real_path</span><span class="tok-p">.</span><span class="tok-n">exists</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">old_content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">fs</span><span class="tok-p">::</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">real_path</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">old_content</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">Ok</span><span class="tok-p">(());</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">files</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">());</span>

<span class="tok-w">    </span><span class="tok-nb">Ok</span><span class="tok-p">(())</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">eval</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_interpreter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">error</span><span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-s">&quot;eval not supported in fake output&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">::</span><span class="tok-n">AsciidoctrineError</span><span class="tok-p">::</span><span class="tok-n">Childprocess</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">enum</span><span class="tok-w"> </span><span class="tok-nc">Env</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-n">Io</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">Cache</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-n">FakeOutput</span><span class="tok-p">(</span><span class="tok-n">FakeOutput</span><span class="tok-p">),</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">get_cache</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-n">_</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">get_files</span><span class="tok-p">()),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">FakeOutput</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">get_files</span><span class="tok-p">()),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Environment</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Env</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">read_to_string</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">FakeOutput</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">read_to_string</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">write</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">path</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">FakeOutput</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">path</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>

<span class="tok-w">  </span><span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-nf">eval</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">interpreter</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nc">crate</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Io</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">eval</span><span class="tok-p">(</span><span class="tok-n">interpreter</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">eval</span><span class="tok-p">(</span><span class="tok-n">interpreter</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">      </span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">FakeOutput</span><span class="tok-p">(</span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">.</span><span class="tok-n">eval</span><span class="tok-p">(</span><span class="tok-n">interpreter</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-p">),</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect1">
<h2 id="install">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install directly from the sources you will need to have
<a href="https://doc.rust-lang.org/cargo/getting-started/installation.html">cargo</a>
installed first.</p>
</div>
<div class="paragraph">
<p>After that run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>cargo<span class="tok-w"> </span>install<span class="tok-w"> </span>asciidoctrine</code></pre>
</div>
</div>
<div class="paragraph">
<p>from the command line.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build">Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests">Tests</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_testumgebung">Testumgebung</h3>
<div class="paragraph">
<p>Um <code>asciidoctrine</code> zu testen verwenden wir die im Userguide
beschriebenen Beispiele.</p>
</div>
<div class="paragraph">
<p>Der generelle Aufbau eines Tests ist:</p>
</div>
<div id="unit-test-template" class="listingblock">
<div class="title">Grundlegender Aufbau eines Unit Tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#[test]</span>
<span class="tok-k">fn</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-n">test_name</span><span class="tok-p">}()</span><span class="tok-w"> </span><span class="tok-p">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">()</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">r#&quot;{asciidoc_content}&quot;#</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">AsciidocReader</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">();</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">opts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">options</span><span class="tok-p">::</span><span class="tok-n">Opts</span><span class="tok-p">::</span><span class="tok-n">parse_from</span><span class="tok-p">(</span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-s">&quot;asciidoctrine&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;--template&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;-&quot;</span><span class="tok-p">]);</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">util</span><span class="tok-p">::</span><span class="tok-n">Env</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">(</span><span class="tok-n">util</span><span class="tok-p">::</span><span class="tok-n">Cache</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">());</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ast</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">env</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">buf</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">BufWriter</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-nb">Vec</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">());</span>
<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">HtmlWriter</span><span class="tok-p">::</span><span class="tok-n">new</span><span class="tok-p">();</span>
<span class="tok-w">  </span><span class="tok-n">writer</span><span class="tok-p">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">ast</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">opts</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">buf</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>

<span class="tok-w">  </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-p">::</span><span class="tok-n">from_utf8</span><span class="tok-p">(</span><span class="tok-n">buf</span><span class="tok-p">.</span><span class="tok-n">into_inner</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-fm">assert_eq!</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">output</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s">r#&quot;{expected_content}&quot;#</span>
<span class="tok-w">  </span><span class="tok-p">);</span>

<span class="tok-w">  </span><span class="tok-nb">Ok</span><span class="tok-p">(())</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Anschließend packen wir alle Tests in eine Datei:</p>
</div>
<div class="listingblock">
<div class="title">tests/asciidoc_to_html_test.rs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">anyhow</span><span class="tok-p">::</span><span class="tok-nb">Result</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">asciidoctrine</span><span class="tok-p">::{</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-p">};</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">clap</span><span class="tok-p">::</span><span class="tok-n">Parser</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">pretty_assertions</span><span class="tok-p">::</span><span class="tok-n">assert_eq</span><span class="tok-p">;</span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-p">::</span><span class="tok-n">io</span><span class="tok-p">::</span><span class="tok-n">BufWriter</span><span class="tok-p">;</span>

<span class="tok-o">&lt;&lt;</span><span class="tok-n">html</span><span class="tok-o">-</span><span class="tok-n">unit</span><span class="tok-o">-</span><span class="tok-n">tests</span><span class="tok-o">&gt;&gt;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="paragraph">
<p>Um die Tests zu erzeugen gehen wir alle Beispiele im Userguide durch,
welche mit entsprechenden Attributen gekennzeichnet wurden.</p>
</div>
<div id="html-unit-tests" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="js"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">template</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nx">lisi</span><span class="tok-p">.</span><span class="tok-nx">get_snippet</span><span class="tok-p">(</span><span class="tok-s2">&quot;unit-test-template&quot;</span><span class="tok-p">).</span><span class="tok-nx">content</span><span class="tok-p">;</span>
<span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">tests</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">;</span>

<span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-nx">name</span><span class="tok-w"> </span><span class="tok-ow">in</span><span class="tok-w"> </span><span class="tok-nx">lisi.get_snippet_names</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-nx">name</span><span class="tok-p">.</span><span class="tok-nx">contains</span><span class="tok-p">(</span><span class="tok-s2">&quot;unittest_&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-nx">name</span><span class="tok-p">.</span><span class="tok-nx">contains</span><span class="tok-p">(</span><span class="tok-s2">&quot;_input&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">out_template</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nx">template</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">compare_out</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">snippet</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nx">lisi</span><span class="tok-p">.</span><span class="tok-nx">get_snippet</span><span class="tok-p">(</span><span class="tok-nx">name</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-nx">out_template</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot;{test_name}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nx">snippet</span><span class="tok-p">.</span><span class="tok-nx">attrs</span><span class="tok-p">.</span><span class="tok-nx">name</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">asciidoc_content</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s2">&quot;\n&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nx">snippet</span><span class="tok-p">.</span><span class="tok-nx">content</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s2">&quot;\n&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nx">asciidoc_content</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot; -- &lt;1&gt;&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-nx">asciidoc_content</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot; -- &lt;2&gt;&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-nx">out_template</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot;{asciidoc_content}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nx">asciidoc_content</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nx">output_snippet</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nx">lisi</span><span class="tok-p">.</span><span class="tok-nx">get_snippet</span><span class="tok-p">(</span><span class="tok-nx">snippet</span><span class="tok-p">.</span><span class="tok-nx">attrs</span><span class="tok-p">.</span><span class="tok-nx">output</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-nx">out_template</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot;{expected_content}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nx">output_snippet</span><span class="tok-p">.</span><span class="tok-nx">content</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s2">&quot;\n&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-nx">tests</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-nx">out_template</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nx">tests</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-s2">&quot;\n\n&quot;</span><span class="tok-p">;</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nx">lisi</span><span class="tok-p">.</span><span class="tok-nx">store</span><span class="tok-p">(</span><span class="tok-s2">&quot;html-unit-tests&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nx">tests</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verwandte_projekte">Verwandte Projekte</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Es gibt einige Projekte mit vergleichbaren Zielen und teilweise auch einer vergleichbaren Architektur wie asciidoctrine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>asciidoc TODO</p>
</li>
<li>
<p><a href="http://asciidoctor.org">asciidoctor</a> ist der Standard um asciidoc Dokumente zu rendern. Es ist in ruby geschrieben. Da der interne AST aber nicht direkt manipulierbar ist (obwohl es natürlich Möglichkeiten für Erweiterungen und auch viele tolle Plugins gibt) scheint es mir nicht ganz so flexibel wie asciidoctrine zu sein.</p>
</li>
<li>
<p><a href="http://jgm.github.io/lunamark/doc/lunamark.html">lunamark</a> wurde ja bereits in der Einleitung erwähnt. Es war eine große Quelle der Inspiration für dieses Projekt.</p>
</li>
<li>
<p><a href="https://pandoc.org/">Pandoc</a> ist ein Projekt mit einem sehr ähnlichen Aufbau. Es ist eine großartige Software und kommt vom gleichen Autor wie lunamark. Es wurde in Haskell geschrieben. Der große Unterschied (und auch der Grund, warum ich die Ziele von asciidoctrine nicht damit erreichen kann) ist, dass es einen <a href="https://hackage.haskell.org/package/pandoc-types/docs/Text-Pandoc-Definition.html">simpleren AST</a> benutzt (denn die Ausgangssprache ist hier Markdown). Daher kann es einiges nicht abbilden was ich gerne in Dokumenten verwende.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>